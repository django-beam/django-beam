{% extends "beam/base.html" %}
{% load i18n %}
{% load crispy_forms_tags %}
{% load beam_tags %}

{% block extra_scripts %}{{ block.super }}{{ form.media.js }}{% endblock %}
{% block extra_styles %}{{ block.super }}{{ form.media.css }}{% endblock %}

{% block content %}
    <form method="post" enctype="multipart/form-data" novalidate>
        {% csrf_token %}
        {% if form.non_field_errors %}
            <div class="alert alert-block alert-danger">
                <ul>
                    {{ form.non_field_errors|unordered_list }}
                </ul>
            </div>
        {% endif %}

        <section>
            <div class="container">
                {% block links %}
                    <div class="float-right">
                        {% include "beam/partials/links.html" %}
                    </div>
                {% endblock %}

                {% block heading %}
                    <h1>
                        {% get_options viewset_context.model as options %}
                        {% blocktrans with verbose_name=options.verbose_name %}Create {{ verbose_name }}{% endblocktrans %}
                    </h1>
                {% endblock %}

                {% block form_buttons_top %}
                    <div class="container-fluid mb-2">
                        <div class="row">
                            <div class="btn-group ml-auto">
                                <button type="submit" class="btn btn-primary">{% trans "Save" %}</button>
                            </div>
                        </div>
                    </div>
                {% endblock %}

                {% include "beam/partials/form_layout.html" with form=form fields=viewset_context.fields layout=viewset_context.layout only %}
            </div>
        </section>

        {% block inlines %}
            {% for inline in inlines %}
                {% block inline %}
                    <section id="{{ inline.formset.prefix }}-group" class="border-top js-django-inlines inline-group">
                        <div class="container">
                            <h2 class="pt-2">{{ inline.get_title|capfirst }}</h2>
                            {{ inline.formset.management_form }}

                            <div class="inline-group">
                                {% for form in inline.formset %}
                                    <div id="{{ inline.formset.prefix }}-{{ forloop.counter0 }}" class="inline-related">
                                        {% if form.non_field_errors %}
                                            <div class="alert alert-block alert-danger">
                                                <ul>
                                                    {{ form.non_field_errors|unordered_list }}
                                                </ul>
                                            </div>
                                        {% endif %}
                                        {% if inline.formset.can_delete %}
                                            <button class="btn btn-warning btn-sm js-remove-form pull-right">{% trans "delete" %}</button>
                                        {% endif %}
                                        {% include "beam/partials/form_layout.html" with form=form fields=inline.fields layout=inline.layout only %}
                                    </div>
                                {% endfor %}
                                <div class="inline-related empty-form d-none">
                                    {% if inline.formset.can_delete %}
                                        <button class="btn btn-warning btn-sm js-remove-form pull-right">{% trans "delete" %}</button>
                                    {% endif %}
                                    {% include "beam/partials/form_layout.html" with form=inline.formset.empty_form fields=inline.fields layout=inline.layout only %}
                                </div>
                            </div>
                            <div class="container-fluid mb-2">
                                <div class="row">
                                    <div class="btn-group ml-auto">
                                        {% get_options inline.formset.model as inline_options %}
                                        <button class="btn btn-secondary btn-sm js-add-form">{% blocktrans with name=inline_options.verbose_name %}add {{ name }}{% endblocktrans %}</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                {% endblock %}
            {% endfor %}
        {% endblock %}

        <section>
            <div class="container">
                {% block form_buttons %}
                    <div class="container-fluid mb-2">
                        <div class="row">
                            <div class="btn-group ml-auto">
                                <button type="submit" class="btn btn-primary">{% trans "Save" %}</button>
                            </div>
                        </div>
                    </div>
                {% endblock %}
            </div>
        </section>
    </form>
{% endblock %}
